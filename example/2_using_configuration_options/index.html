<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
	<title>Bindery - Single Page</title>
  <link rel="stylesheet" type="text/css" href="style.css" />
</head>

<body>
  <section class="content">
		<h2>
			Bindery.js
		</h2>

		<h2>
			Table of Contents
		</h2>
		<ul class="toc">
			<li>
				<a href="#section1">Section 1</a>
			</li>
			<li>
				<a href="#section2">Section 2</a>
			</li>
			<li>
				<a href="#section3">Section 3</a>
			</li>
			<li>
				<a href="#section4">Section 4</a>
			</li>
			<li>
				<a href="#section5">Section 5</a>
			</li>
		</ul>

    <h2 id="section1" bindery-break="before">
      Section 1 and maybe the ok <a href="#">something longer</a>
    </h2>

    <script>
			var blahs = function() {
				let p1 = (new Array(parseInt(Math.random()*10))).join(" Blah ");
				let a = "";
				if ( Math.random() > 0.8 ) {
					a = ". Read more <a href='https://en.wikipedia.org/wiki/Lorem_ipsum'>on Wikipedia</a>."
				}
				let p2 = (new Array(parseInt(Math.random()*20))).join(" Blah ");
				return p1 + a + p2;
			}
      for (var i = 0; i < 10; i++) {
        document.write(`<p>This is paragraph 1:${i}. ${blahs()} End.</p>`)
      }
    </script>

		<figure class="big-figure">
      <figcaption>This is the caption. Just imagine its a really great explanation of everything you'd want to know about this.</figcaption>
    </figure>

		<script>
      for (var i = 0; i < 10; i++) {
        document.write(`<p>This is paragraph 1a:${i}. ${blahs()} End.</p>`)
      }
    </script>


    <div class="aside" id="test" bindery-break="avoid">
      <script>
        for (var i = 0; i < 10; i++) {
          document.write(`<p>This is aside 1:${i}. ${blahs()} End.</p>`)
        }
      </script>
    </div>

    <h2 id="section2" bindery-break="before">Section 2</h2>

    <figure bindery-break="avoid">
      <figcaption>This is the caption. Just imagine its a really great explanation of everything you'd want to know about this.</figcaption>
    </figure>

    <script>
      for (var i = 0; i < 10; i++) {
        document.write(`<p>This is paragraph 2:${i}. ${blahs()} End.</p>`)
      }
    </script>

		<figure class="med-figure">
      <figcaption>This is the caption. Just imagine its a really great explanation of everything you'd want to know about this.</figcaption>
    </figure>

		<figure class="med-figure bleed">
      <figcaption>This is the caption. Just imagine its a really great explanation of everything you'd want to know about this.</figcaption>
    </figure>

		<script>
    for (var i = 0; i < 20; i++) {
      document.write(`<p>This is paragraph 2.1:${i}. ${blahs()} End.</p>`)
    }
    </script>
		<h2 id="section3" bindery-break="before">Section 3</h2>

		<script>
    for (var i = 0; i < 20; i++) {
      document.write(`<p>This is paragraph 3:${i}. ${blahs()} End.</p>`)
    }
    </script>
		<h2 id="section4" bindery-break="before">Section 4</h2>

		<script>
    for (var i = 0; i < 20; i++) {
      document.write(`<p>This is paragraph 4:${i}. ${blahs()} End.</p>`)
    }
    </script>
		<h2 id="section5" bindery-break="before">Section 5</h2>

		<script>
    for (var i = 0; i < 20; i++) {
      document.write(`<p>This is paragraph 5:${i}. ${blahs()} End.</p>`)
    }
    </script>
  </section>


	<script type="text/javascript" src="../../build/bindery.js"></script>
	<script>
		Bindery.makeBook({
		  source: ".content",
		  rules: [
				Bindery.PageBreak({ selector: 'h2', position: 'before', continue: 'right' }),
				Bindery.Footnote({
					selector: 'p > a',
					render: (elmt, number) => `<sup>${number}</sup> Link to <u>${elmt.href}</u>`,
				}),
				Bindery.Footnote({ selector: 'p' }),
				Bindery.FullPage({ selector: '.med-figure' }),
				Bindery.Spread({ selector: '.big-figure' }),
				Bindery.RunningHeader({
					beginSection: 'h2',
					render: (page) => {
						if (page.isEmpty) return '';
						else if (page.element.querySelector('h2')) return '';
						else if (page.isLeft) return `${page.number} · ${page.section} `;
						else if (page.isRight) return `John P. Author · ${page.number}`;
					},
				}),
				Bindery.PageReference({
					selector: ".toc a",
					replace: (element, number) => {
						let row = document.createElement('div');
						row.innerHTML = `${element.textContent}`;
						row.innerHTML += `<span style='float: right;'>${number}</span>`;
						return row;
					}
				}),
		  ],
		});
	</script>
</body>
</html>
